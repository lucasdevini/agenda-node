{{>partials/user/userHeader}}
    <main class="flex justify-center my-6">
        <div class="w-2/3 flex flex-col items-center bg-[#374A90] rounded py-2 px-6 md:w-1/3">
            <h2 class="w-full md:w-1/2 text-center font-bold text-2xl mt-5 text-[#E47B38]">Formulário de Agendamento</h2>
            <form action="" method="POST" class="w-full flex flex-col my-5" id="schedule-form">
                <div class="w-full self-center md:self-start md:w-max">
                    <label for="data" class="text-white">Data de Agendamento:</label> <br>
                    <input type="date" id="data" name="date" required class="w-full mb-5 rounded p-1 bg-[#DBD2D1]">
                </div>

                <div class="w-full self-center md:self-start md:w-max">
                    <label for="hour" class="text-white">Hora:</label> <br>
                    <input type="time" id="hour" name="hour" required class="w-full mb-5 rounded p-1 bg-[#DBD2D1]">
                </div>

                <div class="form-group">
                    <input type="submit" value="Agendar" class="w-full  p-1 border-2 cursor-pointer bg-[#374A90] border-white] text-white transition-colors ease-in rounded hover:bg-[#E47B38] hover:scale-105 hover:border-[#E47B38]">
                </div>
            </form>
        </div>
    </main>

    <script>
        const form = document.getElementById('schedule-form');
        const inputData = document.getElementById('data');

        // Obtém a data atual no formato "YYYY-MM-DD" e atribui ao atributo min do input de data
        const dataAtual = new Date().toISOString().split('T')[0];
        inputData.min = dataAtual;

        // Impede que usuário seleciona sábados e domingos
        inputData.addEventListener('change', () => {
            const selectedDate = new Date(inputData.value);
            const dayOfWeek = selectedDate.getDay(); 

            if (dayOfWeek === 5 || dayOfWeek === 6) {
                alert('Sábados e domingos não são permitidos.');
                inputData.value = ''; // Limpa o valor selecionado
            }
        });

        // tráfego de dados com o backend
        form.addEventListener('submit', async (event) => {
            event.preventDefault();

            const date = form.querySelector('[name="date"]').value;
            const hour = form.querySelector('[name="hour"]').value;

            const requestData = {
                date,
                hour
            }; 

            try {
                const response = await fetch('/schedule-form', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                });

                const responseData = await response.json();

                if (response.status === 200) {
                    alert(responseData.success);
                    window.location.href = '/my-schedules';
                } else if(response.status === 400) {
                    if (responseData.errors) {
                        alert(responseData.success);
                    } else if (responseData.error) {
                        alert(responseData.error);
                    }
                } 
            } catch {
                alert('Ocorreu um erro ao processar sua solicitação. Por favor, tente novamente mais tarde.');
            }
        });
    </script>
</body>
</html>
